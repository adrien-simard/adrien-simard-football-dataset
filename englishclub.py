# -*- coding: utf-8 -*-
"""Englishclub.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/gist/adrien-simard/d20419fd4c94405a81850b4108b014ef/club.ipynb
"""

from urllib.request import urlopen
from bs4 import BeautifulSoup
import pandas as pd

html = urlopen("https://fbref.com/en/comps/16/League-Two-Stats")
html_soup = BeautifulSoup(html, 'html.parser')
rows = html_soup.findAll("div",class_="overthrow table_container")
print(len(rows))

trs = rows[1].table.findAll("tr")
trs[2].a.findAll("href")
trs2 = rows[0].table.findAll("tr")
trs2[1:][0].findAll("td",class_="right")[-1].text

data=trs[2:][1].findAll("td",class_="right")
l = trs[2:]
m=trs2[1:]
m[0].a

clubLeagueA = []
for row in range(len(l)):
    
    try:
        club4 = {
                "name": l[row].a.text,
                "games_home": l[row].findAll("td",class_="right")[0].text,
                "wins_home": l[row].findAll("td",class_="right")[1].text,
                "draws_home": l[row].findAll("td",class_="right")[2].text,
                "losses_home": l[row].findAll("td",class_="right")[3].text,
                "goals_for_home": l[row].findAll("td",class_="right")[4].text,
                "goals_against_home": l[row].findAll("td",class_="right")[5].text,
                "goal_diff_home": l[row].findAll("td",class_="right")[6].text,
                "points_home": l[row].findAll("td",class_="right")[7].text,
                "points_avg_home": l[row].findAll("td",class_="right")[8].text,
                "games_away": l[row].findAll("td",class_="right")[9].text,
                "wins_away": l[row].findAll("td",class_="right")[10].text,
                "draws_away": l[row].findAll("td",class_="right")[11].text,
                "losses_away": l[row].findAll("td",class_="right")[12].text,
                "goals_for_away": l[row].findAll("td",class_="right")[13].text,
                "goals_against_away": l[row].findAll("td",class_="right")[14].text,
                "goal_diff_away": l[row].findAll("td",class_="right")[15].text,
                "points_away": l[row].findAll("td",class_="right")[16].text,
                "points_avg_away": l[row].findAll("td",class_="right")[17].text,
                "top_team_scorers":m[row].findAll("td",class_="right")[-2].text,
                "top_keeper":m[row].findAll("td",class_="right")[-1].text
            
            }
        clubLeagueA.append(club4)
        
    except ValueError:
            print("Ouch!")

df = pd.DataFrame(clubLeagueA)
df.to_csv("clubLeagueA.csv")



df2 = df

df3 =pd.concat([df, df2])
len(df3)
df3

html = urlopen("https://fbref.com/en/comps/34/National-League-Stats")
html_soup = BeautifulSoup(html, 'html.parser')
rows = html_soup.findAll("div",class_="overthrow table_container")
print(len(rows))

trs = rows[1].table.findAll("tr")
trs[2].a.findAll("href")
trs2 = rows[0].table.findAll("tr")
trs2[1:][0].findAll("td",class_="right")[-1].text

data=trs[2:][1].findAll("td",class_="right")
l = trs[2:]
m=trs2[1:]
m[0].a

clubLeagueA = []
for row in range(len(l)):
    
    try:
        club4 = {
                "name": l[row].a.text,
                "games_home": l[row].findAll("td",class_="right")[0].text,
                "wins_home": l[row].findAll("td",class_="right")[1].text,
                "draws_home": l[row].findAll("td",class_="right")[2].text,
                "losses_home": l[row].findAll("td",class_="right")[3].text,
                "goals_for_home": l[row].findAll("td",class_="right")[4].text,
                "goals_against_home": l[row].findAll("td",class_="right")[5].text,
                "goal_diff_home": l[row].findAll("td",class_="right")[6].text,
                "points_home": l[row].findAll("td",class_="right")[7].text,
                "points_avg_home": l[row].findAll("td",class_="right")[8].text,
                "games_away": l[row].findAll("td",class_="right")[9].text,
                "wins_away": l[row].findAll("td",class_="right")[10].text,
                "draws_away": l[row].findAll("td",class_="right")[11].text,
                "losses_away": l[row].findAll("td",class_="right")[12].text,
                "goals_for_away": l[row].findAll("td",class_="right")[13].text,
                "goals_against_away": l[row].findAll("td",class_="right")[14].text,
                "goal_diff_away": l[row].findAll("td",class_="right")[15].text,
                "points_away": l[row].findAll("td",class_="right")[16].text,
                "points_avg_away": l[row].findAll("td",class_="right")[17].text,
                "top_team_scorers":m[row].findAll("td",class_="right")[-2].text,
                "top_keeper":m[row].findAll("td",class_="right")[-1].text
            
            }
        clubLeagueA.append(club4)
        
    except ValueError:
            print("Ouch!")

df2 = pd.DataFrame(clubLeagueA)
df.to_csv("clubLeagueA.csv", encoding="utf-8-sig")

def Creationdataframe(Url,nom_league):

  html = urlopen(Url)
  html_soup = BeautifulSoup(html, 'html.parser')
  rows = html_soup.findAll("div",class_="overthrow table_container")

  trs = rows[1].table.findAll("tr")
  trs[2].a.findAll("href")
  trs2 = rows[0].table.findAll("tr")
  trs2[1:][0].findAll("td",class_="right")[-1].text

  data=trs[2:][1].findAll("td",class_="right")
  l = trs[2:]
  m=trs2[1:]
  m[0].a

  nom_dataframe = []
  for row in range(len(l)):
      
      try:
          club4 = {
                  "name": l[row].a.text,
                   "league": nom_league,
                  "games_home": l[row].findAll("td",class_="right")[0].text,
                  "wins_home": l[row].findAll("td",class_="right")[1].text,
                  "draws_home": l[row].findAll("td",class_="right")[2].text,
                  "losses_home": l[row].findAll("td",class_="right")[3].text,
                  "goals_for_home": l[row].findAll("td",class_="right")[4].text,
                  "goals_against_home": l[row].findAll("td",class_="right")[5].text,
                  "goal_diff_home": l[row].findAll("td",class_="right")[6].text,
                  "points_home": l[row].findAll("td",class_="right")[7].text,
                  "points_avg_home": l[row].findAll("td",class_="right")[8].text,
                  "games_away": l[row].findAll("td",class_="right")[9].text,
                  "wins_away": l[row].findAll("td",class_="right")[10].text,
                  "draws_away": l[row].findAll("td",class_="right")[11].text,
                  "losses_away": l[row].findAll("td",class_="right")[12].text,
                  "goals_for_away": l[row].findAll("td",class_="right")[13].text,
                  "goals_against_away": l[row].findAll("td",class_="right")[14].text,
                  "goal_diff_away": l[row].findAll("td",class_="right")[15].text,
                  "points_away": l[row].findAll("td",class_="right")[16].text,
                  "points_avg_away": l[row].findAll("td",class_="right")[16].text,
                  "top_team_scorers":m[row].findAll("td",class_="right")[-2].text,
                  "top_keeper":m[row].findAll("td",class_="right")[-1].text
              
              }
          nom_dataframe.append(club4)
          
      except ValueError:
              print("Ouch!")

  dataframe = pd.DataFrame(nom_dataframe)
  

  return dataframe

df_national_league =Creationdataframe("https://fbref.com/en/comps/34/National-League-Stats","National League")

df_league_two = Creationdataframe("https://fbref.com/en/comps/16/League-Two-Stats","League Two")
df_league_two

df_league_three = Creationdataframe("https://fbref.com/en/comps/15/League-One-Stats","League One")
df_league_three

df_chamionship = Creationdataframe("https://fbref.com/en/comps/10/Championship-Stats","Championship")
df_chamionship

df_premier_league = Creationdataframe("https://fbref.com/en/comps/9/Premier-League-Stats","Premier League")
df_premier_league

df = pd.concat([df_national_league, df_league_two,df_league_three,df_chamionship,df_premier_league])

df.to_csv("EnglishClubsStats.csv")